---
title: "Question One Analysis "
author: "Shahid"
date: "2025-07-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## üíº Diving Into Portfolio Management: Understanding Portfolio Variance

Recently, I began a new challenge: investing in stocks. One of the first questions I thought about was‚Äîregardless of individual returns‚Äîhow could I best create an **optimal investment set of assets**?

This led me into the world of **portfolio management**.

After reading about **Markowitz's theory of optimal portfolios**, I learned that constructing an ideal portfolio relies on just two components:

1. **Expected return (mean)**
2. **Variance or volatility of the portfolio**

Based on this framework, each combination of possible portfolios occupies a unique space in the risk‚Äìreturn plane, forming what we call the **efficient frontier**. *(We‚Äôll skip over the theoretical backdrop for now.)*

---

### ‚ö†Ô∏è The Key Problem

Given we know the volatility and return of all stocks, how do we *efficiently* find:

1. The **variance** of a given portfolio
2. The **expected return** of a given portfolio

I‚Äôll come back to the second part in another blog.  
Today, I‚Äôm focusing on:

### üìä How Do We Calculate the Variance of a Portfolio?

Let‚Äôs break it down in practical, mathematical terms.


# Single Index model 

A key problem when calculating the variacne of a portfolio, 
$$
\sigma_p^2 = \sum_{i=1}^{n} \sum_{j=1}^{n} w_i w_j \sigma_i \sigma_j \rho_{ij}
$$


## üß† Why Covariance Matrices Explode with Portfolio Size

When analyzing a portfolio, one key ingredient is the **covariance matrix**‚Äîthe foundation for calculating portfolio variance, optimal weights, and risk. But as the number of assets grows, so does the matrix... fast.

## What Is a Covariance Matrix?

It‚Äôs a table showing how each asset moves in relation to the others. If you're analyzing **n** stocks, you need an **n √ó n** matrix to account for every pairwise relationship‚Äîincluding each asset‚Äôs own variance.

### ‚öñÔ∏è Scaling Example

- With **3 stocks**, the matrix size is  
  \( 3 \times 3 = 9 \) components
- With **100 stocks**, the matrix balloons to  
  \( 100 \times 100 = 10{,}000 \) components üò¨

That's 10,000 entries just for one statistical matrix!

###üí° Are All Components Unique?

Nope. Since the covariance matrix is **symmetric**, only the **upper (or lower) triangle** and **diagonal** contain unique data. The number of distinct elements is:

$$
\frac{n(n + 1)}{2}
$$

So for **100 stocks**:

$$
\frac{100 \times 101}{2} = 5{,}050
$$

Still huge‚Äîjust not as bad as 10,000!

### üìà Why It Matters

As portfolios scale into dozens or hundreds of assets, computing and inverting the covariance matrix becomes more intensive.

## How the Single Model Index simplifies this process?
We since we don't want to do all these calculation, we can simplify this process by compared each stock in our portfolio to a given market index. We 'assume' that all stocks move with a a given market index. That is the return of any given stocks and made of, (1) Our Chosen market index , known as systmetic risk and (2) firm specific risk including company perforamcen, knownn as our unsystematic risk.This relation ship can be show through 

\begin{equation}
R_i = = \text{unsystematic risk + systematic risk} = \alpha_i + \varepsilon_i + \beta_i R_m 
\end{equation}

Now, $\alpha$ is the portion of our stock‚Äôs return not explained by the market; $\varepsilon_i$ is our 'variation' or error term that is specific to the firm. These are unpredictable and uncorrelated with market movements ‚Äî think scandals, product launches, or failures. Importantly, our $\beta$ represents the expected change in our stock‚Äôs return, $R_i$, given a change in the market index, $R_m$.

As you would note, the Single-Index Model assumes a linear regression ‚Äî that is, our stock return is linearly related to the market return. This is a strong assumption, but a useful starting point. Of course, we can later assume a non-linear relationship between $R_i$ and $R_m$, which leads us into models like GARCH, polynomial regression, and others. 

# Lets get into a problem

Monthly return data are presented below for each of three stocks and the S&P index
(corrected for dividends) for a 12-month period. Calculate the following quantities:

1. alpha for each stock

2. beta for each stock

3. the standard deviation of the residuals from each regression

4. the correlation coefficient between each security and the market

5. the average return on the market

6. the variance of the market

# Exploratory Data Analysis 
## Time Series Plot

```{r df, echo=FALSE}
suppressWarnings(suppressPackageStartupMessages(library(ggplot2)))
library(ggplot2)
df <- read.csv("./question_one_4_stocks_dataset.csv")

# Exploratory Data Analysis
# ggplot(data = df)
ggplot(df, aes(x = Month)) + 
  geom_line(aes(y = A, color = "A")) + 
  geom_line(aes(y = B, color = "B")) + 
  geom_line(aes(y = C, color = "C")) + 
  geom_line(aes(y = `S.P`, color = "S&P")) + 
  labs(title = "Monthly Returns for Securities A, B, C, and S&P", 
       x = "Month", y = "Returns (%)", color = "Security") +
  theme_minimal()
```
By Visual Inspections we can note with S&P as our benchmark 

- there a period of correlation for all three stocks A,B,C followed by some period.

- From a visual inspection the highest correlated stock is A.

- Seasonality: 
  - 1-2 : decline 
  
  - 5 - 6 : all stock prices declined 
  
  - 10 - 12 : all stock prices declined

- Stock C is extremelt volitile compare to other stocks

# Single Index Model Implementation 
## Step 1 : Creating a linear regression to find our $\beta$, $a_i$
Given in a Single Index Model we assume the relation between a given stocks is based on the market index. Suppose we have a S&P500 as our market index. Now we can find out create a linear regression $R_i = a_i + \beta_i R_m + \epsilon$. Graphing these result, 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Load libraries
library(ggplot2)
library(patchwork)

# Load dataset (change path if needed)
df <- read.csv("~/Github/portfolio-management/modern-portfolio-theory-and-investment-analysis/week-7-the-correlation0-structure-of-secruity-returns-SIM/question_one_4_stocks_dataset.csv")

# Market and individual stock returns
R_m <- df$S.P
R_a <- df$A
R_b <- df$B
R_c <- df$C

# Linear regression models
model.a.s.p <- lm(R_a ~ R_m)
model.b.s.p <- lm(R_b ~ R_m)
model.c.s.p <- lm(R_c ~ R_m)

# Coefficients
a.coef <- coef(model.a.s.p)
b.coef <- coef(model.b.s.p)
c.coef <- coef(model.c.s.p)

# Sequence for regression lines
x.s.p <- seq(from = -10 , to = 20, by = 0.25)
y.a <- a.coef[1] + a.coef[2]*x.s.p
y.b <- b.coef[1] + b.coef[2]*x.s.p
y.c <- c.coef[1] + c.coef[2]*x.s.p

line_df <- data.frame(x = x.s.p, y.a = y.a, y.b = y.b, y.c = y.c)

# Plot for A
pa.and.lm <- ggplot(df, aes(x = S.P, y = A)) +
  geom_point(color = "steelblue") +
  geom_line(data = line_df, aes(x = x, y = y.a), color = "darkred", size = 1.2) +
  annotate("text", x = 2, y = 20,
           label = paste0("R_i = ", round(a.coef[2], 2), "R_m + ", round(a.coef[1], 2)),
           size = 3)

# Plot for B
pb.and.lm <- ggplot(df, aes(x = S.P, y = B)) +
  geom_point(color = "steelblue") +
  geom_line(data = line_df, aes(x = x, y = y.b), color = "darkred", size = 1.2) +
  annotate("text", x = 2, y = 20,
           label = paste0("R_i = ", round(b.coef[2], 2), "R_m + ", round(b.coef[1], 2)),
           size = 3)

# Plot for C
pc.and.lm <- ggplot(df, aes(x = S.P, y = C)) +
  geom_point(color = "steelblue") +
  geom_line(data = line_df, aes(x = x, y = y.c), color = "darkred", size = 1.2) +
  annotate("text", x = 2, y = 50,
           label = paste0("R_i = ", round(c.coef[2], 2), "R_m + ", round(c.coef[1], 2)),
           size = 3)

# Combine plots
graph.scatter.lm.line <- pa.and.lm + pb.and.lm + pc.and.lm + 
  plot_layout(ncol = 2) +
  plot_annotation("Scatter plots comparing each stock's return to market return with regression lines")

print(graph.scatter.lm.line)
```

Now given we can estimate the return of reach individual stock given by 
$$
\mathbb{E}[R_i] = \alpha_i + \beta_i \mathbb{E}[R_m]
$$
Using our data, we can calculate our expected market return $\mathbb{E}[R_m] = 3.005$. From this for each stock A,B,C we can calculate our Expected return for each stock 

$$
\begin{aligned}
\mathbb{E}
\begin{bmatrix}
R_a \\
R_b \\
R_c
\end{bmatrix}
&=
\begin{bmatrix}
a_a \\
a_b \\
a_c
\end{bmatrix}
+

\begin{bmatrix}
\beta_a \\
\beta_b \\
\beta_c
\end{bmatrix} \cdot \mathbb{E}[R_m] \\
&=
\begin{bmatrix}
-0.61 \\
3.25 \\
-0.13
\end{bmatrix}
+
\begin{bmatrix}
1.18 \\
0.98 \\
2.4
\end{bmatrix}
\cdot 3.005 \\
&=
\begin{bmatrix}
2.9359 \\
6.1949 \\
7.082
\end{bmatrix}.
\end{aligned}
$$

Now suppose suppose we have $1500 to invest and we decided to invest into each $500. What would be our expected return?

Using the Single Index Model we would calculate
$$
\begin{align*}
\mathbb{E}[R_p] &= \sum_{i=a,b,c} \frac{1}{3} \mathbb{E}[R_i] \\
&= \frac{1}{3} \times 2.9359 + \frac{1}{3} \times 6.1949 + \frac{1}{3} \times 5.409167 \\
&= \frac{1}{3} (2.9359 + 6.1949 + 5.409167) \\
&= 4.84665
\end{align*}

$$
Now, given our investment 

$$
(\text{investment amount}) * \mathbb{E}[R_p] = 15000 * 4.84665 = 17269.98
$$

